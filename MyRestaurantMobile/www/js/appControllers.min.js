mrc.controller('AppCtrl',[ '$scope', '$ionicModal', '$timeout', '$state', '$auth', '$rootScope', '$ionicPopup', '$filter',
                  function($scope, $ionicModal, $timeout, $state, $auth, $rootScope, $ionicPopup, $filter) {

  // With the new view caching in Ionic, Controllers are only called
  // when they are recreated or on app start, instead of every page change.
  // To listen for when this page is active (for example, to refresh data),
  // listen for the $ionicView.enter event:
  //$scope.$on('$ionicView.enter', function(e) {
  //});

  var vm = this;

  // Form data for the login modals
  vm.loginData = {};

  // Create the login modal that we will use later
  $ionicModal.fromTemplateUrl('templates/login.html', {
    scope: $scope,
    animation: 'slide-in-up'
  }).then(function(modal) {
    vm.modal = modal;
  });

  //Triggered in the login modal to close it
  vm.closeLogin = function() {
    vm.modal.hide();
  };

  // Open the login modal
  vm.login = function() {
    vm.modal.show();
  };

  // Perform the login action when the user submits the login form
  vm.doLogin = function(provider) {
    $auth.login(vm.loginData, {url: $rootScope.app.apiUrl + '/api/auth/authenticate', method: 'POST'})
    .then(function(response) {
      vm.closeLogin();
    })
    .catch(function(response) {
      // Handle errors here, such as displaying a notification
      // for invalid email and/or password.
      vm.showAlert('global.LOGIN_ERROR_TITLE', 'global.LOGIN_ERROR_MESSAGE');
      vm.loginData.password = null;

    });

  };

  vm.isActive = function(stateName){
    return $state.includes(stateName);
  };

  vm.isAuthenticated = function() {
    return $auth.isAuthenticated();
  };

  vm.showAlert = function(title, message) {

         //Translates title and message
         var titleTranslated = $filter('translate')(title);
         var messageTranslated = $filter('translate')(message);

         //Creates the popup
         var alertPopup = $ionicPopup.alert({
           title: titleTranslated,
           template: messageTranslated
         });

         //Displays the popup
         alertPopup.then(function(res) {
           console.log('Thank you for not eating my delicious ice cream cone');
         });
       };

}]);

mrc.controller('CategoriesCtrl', ["$translate", "$state", "$ionicHistory", "$http", function($translate, $state, $ionicHistory, $http) {

  var vm = this;

  vm.categories = [];

  vm.getCategories = function(){
    // Simple GET request example:
    $http({
      method: 'GET',
      url: 'http://myrestaurant.dev/api/category'
    }).then(function successCallback(response) {
        angular.forEach(response.data.categories, function(value,key){
          vm.categories.push(value);
        });
      }, function errorCallback(response) {
        // called asynchronously if an error occurs
        // or server returns response with an error status.
      });
  };

  vm.getCategories();


}]);

mrc.controller('CategoryCtrl', ["$scope", function($scope) {

	var vm = this;

	vm.items = [
		{
			title: "Food 1",
			shortDescription: "Bla bla bla"
		},
		{
			title: "Food 2",
			shortDescription: "Bla bla bla"
		},
		{
			title: "Food 3",
			shortDescription: "Bla bla bla"
		}
	];

	vm.clearSearch = function(){
		vm.searchItem = '';
	}
}]);

mrc.controller('ContactCtrl', ["$scope", function($scope) {

}]);
mrc.controller('PlaylistsCtrl', ["$scope", function($scope) {
  $scope.playlists = [
    { title: 'Reggae', id: 1 },
    { title: 'Chill', id: 2 },
    { title: 'Dubstep', id: 3 },
    { title: 'Indie', id: 4 },
    { title: 'Rap', id: 5 },
    { title: 'Cowbell', id: 6 }
  ];
}]);
mrc.controller('MenuItemCtrl', ["$scope", function($scope) {
 
}]);
mrc.controller('SettingsCtrl', ["$scope", function($scope) {

}]);
mrc.controller('TranslateCtrl', ["$translate", "$state", "$ionicHistory", function($translate, $state, $ionicHistory) {
  
  var vm = this;

  vm.changeLanguage = function (langKey) {
    $translate.use(langKey);
    
    $ionicHistory.nextViewOptions({
	    disableBack: true
  	});

    $state.go('app.home');
    
  };

}]);